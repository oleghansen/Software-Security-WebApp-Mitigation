{% extends 'base.twig' %}

{% block content %}

    <h2>Edit profile</h2>

    <form action="" method="POST" onsubmit="return validate()">
        <div id="flasherror">{{ flash.error }}</div>
        <div id="feil"></div>
        <label>Full name:</label>
        <input type = "text" id="fullname" name="fullname" onChange="validateFullName()" value= "{{ user.fullname }}"> <br />

        <label>Address:</label>
        <input type = "text" id="address"name="address" onChange="validateAddress()" value= "{{ user.address }}"> <br />

        <label>Postcode:</label>
        <input type = "text" id="postcode"name="postcode" onChange="validatePostCode()"  value= "{{ user.postcode }}"> <br />

        <label>Email:</label>
        <input type="text" id="email"name="email" value="{{ user.email|raw}}"> <br />

        <label>Bio:</label>
        <textarea name="bio" id="bio">{{ user.bio }}</textarea>

        <label>Age:</label>
        <input type="text" id="age"name="age" value="{{ user.age }}"> <br />

        <input type="submit" name="submit" value="Save profile">
    </form>

    <script type="text/javascript">


    

    function validateFullName() {
        var regex = /^[a-zA-Z]{2,50}/;
        var OK = regex.test(document.getElementById("fullname").value);

        if(!OK) {
            document.getElementById("feil").innerHTML ="FullName need to contain between 2 and 50 letters.";
            return false;
        }
        return true;
    }

    function validateAddress() {

        var regex = /^[a-zA-Z0-9]{2,70}/;
        var OK = regex.test(document.getElementById("address").value);

        if(!OK) {
            document.getElementById("feil").innerHTML ="Address need to contain between 2 and 70 numbers and letters.";
            return false;
        }
        return true;
    }


    function validatePostCode() {
        var regex = /^[0-9]{4}/;
        var OK = regex.test(document.getElementById("postcode").value);

        if(!OK) {
            document.getElementById("feil").innerHTML ="The areacode/postcode must contain 4 numbers.";
            return false;
        }
        return true;
    }

    function validateEmail() {

    var regex = /^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i;

    var OK = regex.test(document.getElementById("email").value);

    if(!OK) {
        document.getElementById("feil").innerHTML = "Invalid email";
        return false;
    }
    return true;

    }

    function validateBio() {

        var regex = /^[a-zA-Z0-9]{1,250}/;
        var OK = regex.test(document.getElementById("bio").value);

        if(!OK) {
        document.getElementById("feil").innerHTML = "Bio can not be empty! Illegal symbols used in bio";
        return false;
        }
        return true;

    }
    function validateAge() {
        var regex = /^[0-9]{1,3}/;
        var OK = regex.test(document.getElementById("age").value);
        
        if(!OK) {
        document.getElementById("feil").innerHTML ="Age can only contain numbers. Must be between 0 and 130.";
        return false;
        }
        return true;

    }
    function validate() {
        var OK = true;

        if(!validateEmail()) {
           OK = false;
        }
        if(!validateAge()) {
            OK = false;
            
        }
        if(!validateBio()) {
            OK = false;
           
        }
        if(!validateFullName()) {
            OK = false;
            
        }
        if(!validatePostCode()) {
            OK = false;
            
        }
        if(!validateAddress()) {
            OK = false;
            
        }
       
        return OK;
    }

    </script>
{% endblock %}
